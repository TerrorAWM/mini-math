# mini-math (小猿口算C语言版)

> 本项目是基于C语言开发的小猿口算版本，灵感来源于知名的口算游戏。该项目是为响应学校“高级语言程序设计”课程的期末要求而开发。

>请注意，本项目仅供学习与练习使用，请勿将此代码作为作业提交，特别是如果你是“Hitter”的话，请避免使用该代码提交。


# 项目说明

## 项目概述
该项目是一个基于TCP协议的多人对战游戏服务器，使用C语言编写，支持玩家通过命令行与服务器进行交互。游戏内容是一个简单的比较大小的题目游戏，玩家需要根据随机生成的两个数字，判断第一个数字是否大于第二个数字。玩家的得分根据其回答的正确性计算。

该服务器支持单人模式和多人对战模式。玩家可以选择单人游戏、创建房间或加入现有房间进行游戏。

## 功能特点

### 多种游戏模式
- **单人游戏**：玩家独自进行游戏，回答10道比较大小的题目，计算得分。
- **多人对战**：玩家可以创建房间，其他玩家可以加入该房间进行游戏。每个房间最多支持两名玩家。

### 题目生成
- 服务器自动生成10道“比较大小”的题目，每道题目由两个随机生成的数字组成，玩家需要选择“>”或“<”来回答。

### 并发处理
- 服务器使用 `pthread` 库处理多个客户端的并发请求。每个玩家或房间的请求都由单独的线程处理，确保服务器能够同时服务多个玩家。

### 房间管理
- 服务器允许玩家创建房间并加入已有房间。每个房间支持最多两名玩家，玩家在房间内共同进行游戏，最后计算得分并展示结果。

### 网络通信
- 基于TCP协议，客户端与服务器之间的通信通过 socket 进行，数据传输通过文本协议进行。

## 技术栈
- **编程语言**：C
- **网络协议**：TCP/IP
- **并发处理**：pthread
- **操作系统**：Linux（使用pthread和socket编程接口）
- **数据结构**：数组（管理房间和玩家信息）
- **随机数生成**：`rand()` 用于生成比较的题目

## 功能模块

### 客户端交互
- 客户端发送请求（例如：单人游戏、创建房间、加入房间）。
- 服务器根据请求类型提供不同的游戏流程。
- 玩家通过网络发送和接收题目及答案。

### 房间管理
- 服务器最多支持 `MAX_ROOMS` 个房间，每个房间最多容纳 `MAX_PLAYERS_PER_ROOM` 名玩家。
- 玩家可以创建新房间或加入已有房间。

### 题目生成与评分
- 每个房间生成10道比较大小的题目。
- 玩家提交答案后，服务器根据玩家的答案计算得分。

### 并发处理
- 每个客户端连接都由一个独立的线程进行处理，避免阻塞。
- 房间内的线程通过互斥锁（mutex）和条件变量（condition variable）同步。

## 安装与运行

### 编译项目
在终端中进入项目目录，使用以下命令编译项目：


**启动服务器**
使用以下命令启动服务器：
```
./server
```
服务器将监听端口 6725，等待客户端连接。

**启动客户端**
客户端可以通过以下命令启动：
```
./game
```
客户端将连接到服务器并提示玩家选择游戏模式（SINGLE、CREATE、JOIN）。

**关闭服务器**
服务器可以通过发送 `Ctrl + C` 终止。

## 交互示例
**客户端请求创建房间**
```
客户端输入: CREATE
服务器响应: 房间ID: ABC123
```
**客户端请求加入房间**
```
客户端输入: JOIN ABC123
服务器响应: 已加入房间
游戏进行中
服务器向玩家发送题目:
5 ? 7
<
```
```
玩家输入: <
服务器返回: 正确
```
**游戏结束后**
```
服务器发送得分:
你的得分: 8/10
```

## 使用的库

- [cJSON](https://github.com/DaveGamble/cJSON): 一个轻量级的 JSON 解析和生成库，适用于 C 语言。
- [curl](https://github.com/curl/curl): 一个强大的库，用于在 C 语言中处理 URL 的数据传输，支持多种协议。


## 未来改进

- **增加题库**：目前题目是随机生成的，未来可以考虑增加题库，提供更多种类的题目。
- **扩展房间人数**：目前每个房间仅支持两名玩家，未来可以扩展为更多玩家的房间。
- **客户端图形化界面**：可以考虑为客户端实现一个图形化界面，使玩家的操作更加直观。
- **持久化存储**：可以将玩家的得分、游戏记录等信息存储在数据库中。

## 贡献

如果你有兴趣改进这个项目，欢迎提交 Pull Request。你可以通过以下方式贡献：

- 修复 bug
- 提供新的功能
- 改进文档

## License

本项目使用 **GPLv3** 许可证，详情请参见 [LICENSE](LICENSE)。

